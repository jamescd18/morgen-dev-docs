import { Callout } from 'nextra-theme-docs'


# Events

Morgen maps Calendar Events from different providers to 
a common data model, inspired by the [JSCalendar standard](https://datatracker.ietf.org/doc/rfc8984/).
Some differences with the JSCalendar standard are documented below.

## List Events

Morgen offers an endpoint to list events from a given calendar.
Events are retrieved in a given time window, and recurring events 
are automatically expanded to their individual occurrences.
Deleted or cancelled events are not included in the response.

```
curl --request GET \
     --url https://sync.morgen.so/v1/events/list?accountId=<ACCOUNT_ID>&calendarIds=<CALENDAR_IDS>&start=<START_DATETIME>&end=<END_DATETIME> \
     --header 'accept: application/json' \
     --header 'Authorization: Bearer JWT_USER_TOKEN'
```

| Parameter | Type | Default | Required | Description |
| :-----    | :---- | :---- | :---- | :---- |
| `accountId` | Query | - | Yes | An account ID to retrieve events from. |
| `calendarIds` | Query | - | Yes | Comma-separated list of calendar IDs to retrieve events from. Notice that these calendars must all belong to the same account identified by `accountId`. |
| `start` | Query | - | Yes | Start of the time window in ISO 8601 format, e.g. `2023-03-01T00:00:00Z` |
| `end` | Query | - | Yes | End of the time window in ISO 8601 format, e.g. `2023-04-01T00:00:00Z`. This must be greater than `start`. The interval cannot be longer than 6 months. It is recommanded to retrieve no more than 2 months of events at the same time.  |

Here is an example response:

```json
{
  "data": {
    "events": [
      {
        "@type": "Event",
        "id": "WyJBUU1rQURaa1lXWXpOel...",
        "calendarId": "WyI2NDBhNjJjOW...",
        "accountId": "640a62c9aa5b7e06cf420000",
        "integrationId": "o365",
        "baseEventId": "AAkALgAAAAAAHYQDEapmEc2by...",
        "created": "2023-02-28T11:50:57",
        "updated": "2023-02-28T17:56:44",
        "title": "Chat about Morgen",
        "description": "<html><body>Description of event, possibly in HTML format.</body></html>",
        "descriptionContentType": "text/html",
        "start": "2023-03-01T10:15:00",
        "duration": "PT25M",
        "showWithoutTime": false,
        "timeZone": "Europe/Berlin",
        "privacy": "public",
        "freeBusyStatus": "free",
        "locations": {
          "1": {
            "@type": "Location",
            "name": "Morgen HQ, Forrlibuckstrasse 223"
          }
        },
        "participants": {
          "ZGF2aWRAbW9yZ2Vu0000": {
            "@type": "Participant",
            "name": "John Doe",
            "email": "doe@morgen.so",
            "roles": {
              "attendee": true,
              "owner": true
            },
            "participationStatus": "needs-action"
          },
          "bWFyY29AbW9yZ2Vu0000": {
            "@type": "Participant",
            "name": "Willie White",
            "email": "white@morgen.so",
            "roles": {
              "attendee": true
            },
            "accountOwner": true,
            "participationStatus": "needs-action"
          },
          ...
        },
        "alerts": {
          "1": {
            "@type": "Alert",
            "trigger": {
              "@type": "OffsetTrigger",
              "offset": "-PT15M",
              "relativeTo": "start"
            },
            "action": "display"
          },
          ...
        },
      },
      ...
    ]
  }
}

```

Please refer to the [JSCalendar standard](https://datatracker.ietf.org/doc/rfc8984/) 
for more information about the data model. Please consider the following differences:

### Differences with JSCalendar

#### Additional fields
Morgen returns some additional fields for convenience and to provide more information about the event:
- `integrationId`: The ID of the integration the event belongs to.
- `accountId`: The ID of the account the event belongs to.
- `calendarId`: The ID of the calendar the event belongs to.
- `baseEventId`: The provider ID of the base event the event belongs to. This is the ID of the recurring event for recurring events, and the ID of the event itself for non-recurring events.
- `masterBaseEventId`: The provider ID of the master base event the event belongs to. This is the ID of the master recurring event for recurring events, and will not be returned for non-recurring events.

## Create an Event

Morgen offers an endpoint to create events in a given calendar.
The event is created in the calendar of the account identified by the `accountId` parameter.

```
curl --request POST \
     --url https://sync.morgen.so/v1/events/create \
     --header 'accept: application/json' \
     --header 'Authorization: Bearer JWT_USER_TOKEN'
     --data '{"accountId": <ACCOUNT_ID>, "calendarId": <CALENDAR_ID>, ...eventfields}'
```

The fields `accountId` and `calendarId` are mandatory. Other fields of an event are described in the [JSCalendar standard](https://datatracker.ietf.org/doc/rfc8984/).

## Update an Event

The following endpoint can be used to update an event in a given calendar.

```
curl --request POST \
     --url https://sync.morgen.so/v1/events/update?seriesUpdateMode=<UPDATE_MODE> \
     --header 'accept: application/json' \
     --header 'Authorization: Bearer JWT_USER_TOKEN'
     --data '{"id": <EVENT_ID>, "accountId": <ACCOUNT_ID>, ...eventfields}'
```

| Parameter | Type | Default | Required | Description |
| :-----    | :---- | :---- | :---- | :---- |
| `seriesUpdateMode` | Query | `single` | No | Defines how to update recurring events. Possible values are: `all` (update all events), `future` (update this and future occurrences), `single` (update this event only, default). This parameter has no effect on non-recurring events. |
| `id` | Body | - | Yes | The ID of the event to update. |
| `accountId` | Body | - | Yes | The ID of the account the event belongs to. |

Other fields of an event are described in the [JSCalendar standard](https://datatracker.ietf.org/doc/rfc8984/).

<Callout type="warning" emoji="⚠️">
  Currently `seriesUpdateMode` only supports the default value (`single`).
</Callout>

## Delete an Event

The following endpoint can be used to update an event in a given calendar.

```
curl --request POST \
     --url https://sync.morgen.so/v1/events/delete?seriesUpdateMode=<UPDATE_MODE> \
     --header 'accept: application/json' \
     --header 'Authorization: Bearer JWT_USER_TOKEN'
     --data '{"id": <EVENT_ID>, "accountId": <ACCOUNT_ID>}'
```

| Parameter | Type | Default | Required | Description |
| :-----    | :---- | :---- | :---- | :---- |
| `seriesUpdateMode` | Query | `single` | No | Defines how to update recurring events. Possible values are: `all` (update all events), `future` (update this and future occurrences), `single` (update this event only, default). This parameter has no effect on non-recurring events. |
| `id` | Body | - | Yes | The ID of the event to update. |
| `accountId` | Body | - | Yes | The ID of the account the event belongs to. |


<Callout type="warning" emoji="⚠️">
  Currently `seriesUpdateMode` only supports the default value (`single`).
</Callout>

## RSVP to an Event

An event can be accepted, declined or tentatively accepted by the user. 
This is done by sending a POST request to the following endpoints:

```
curl --request POST \
     --url https://sync.morgen.so/v1/events/<RSVP_ACTION>?seriesUpdateMode=<UPDATE_MODE> \
     --header 'accept: application/json' \
     --header 'Authorization: Bearer JWT_USER_TOKEN'
      --data '{"id": <EVENT_ID>, "accountId": <ACCOUNT_ID>}'
```

The last segment of the URL marked with `<RSVP_ACTION>` defines the action to be performed. 
Possible values are:
- `accept`: Accept the event.
- `decline`: Decline the event.
- `tentativelyAccept`: Tentatively accept the event.

| Parameter | Type | Default | Required | Description |
| :-----    | :---- | :---- | :---- | :---- |
| `seriesUpdateMode` | Query | `single` | No | Defines how to update recurring events. Possible values are: `all` (update all events), `future` (update this and future occurrences), `single` (update this event only, default). This parameter has no effect on non-recurring events. |
| `id` | Body | - | Yes | The ID of the event to update. |
| `accountId` | Body | - | Yes | The ID of the account the event belongs to. |

<Callout type="warning" emoji="⚠️">
  Currently `seriesUpdateMode` only supports the default value (`single`).
</Callout>